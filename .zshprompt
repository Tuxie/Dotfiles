PROMPT_SUBST=1
if test "$TERM" = "screen-bce"; then
  export TERM=xterm-256color
fi

function Pf { # Prompt foreground colour
  echo -n "%{\\e[38;5;$1m%}"
}
function Pb { # Prompt background colour
  echo -n "%{\\e[48;5;$1m%}"
}
function Pfb { # Prompt foreground + background colour
  echo -n "%{\\e[38;5;$1m\\e[48;5;$2m%}"
}
function Pc { # Prompt clear
  echo -n "%{\\e[0m%}"
}
function Pgitbranch { # Git branch if inside a Git repository
  local branch
  branch=$(git branch 2>&1)
  if test $? -eq 0; then
    test "$(git config --get remote.origin.url)" = "git@github.com:Tuxie/Dotfiles.git" && return
    branch=$(echo $branch | grep '^*' | cut -c3-)
    echo -n "$(Pfb 252 238) ${branch} $(Pc)"
  fi
}

setopt promptsubst

case "$(ifconfig en0 | grep ether)" in
  *00:17:f2:d8:ca:4a*)  PRETTY_HOSTNAME="MacBook Pro" ;;
  *00:24:1d:15:bf:b1*)  PRETTY_HOSTNAME="Desktop"     ;;
  *)                    PRETTY_HOSTNAME="$(hostname)" ;;
esac

PROMPT="%(!:$(Pfb 231 160):$(Pfb 231 22)) %n $(Pc)$(Pfb 81 19) ${PRETTY_HOSTNAME} $(Pc)\$(Pgitbranch) "
RPROMPT="$(Pfb 231 55) %~ $(Pc)%(!:$(Pf 206):$(Pf 229))"

function preexec {
  echo -ne "\ek$CMD\e\\[0m"
}

# vim:ft=zsh
