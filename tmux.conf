set -s escape-time 0
set -g status off
set -g set-titles on
set -g set-titles-string '#T'
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM
set -g history-limit 25000

# If the terminal is starting tmux as a shell, tmux itself won't have the
# normal shell environment, but it still needs the 'tmux' command in its path.
set-environment -g PATH "/opt/homebrew/bin:$PATH"

# The standard prefix is Ctrl-b
# Set the alternative prefix Ctrl-s if we're inside an SSH session
if-shell '[ -n "$SSH_TTY" ]' 'set -g prefix2 C-s'

# Don't require releasing Ctrl after prefix for these basic commands
bind C-c new-window
bind C-n next-window
bind C-p previous-window
bind C-z resize-pane -Z   # Toggle full-screen pane

# Enable vi style navigation in tmux
setw -g mode-keys vi

# Switch pane with prefix + h/j/k/l
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize pane with prefix + Ctrl-h/j/k/l
bind C-h resize-pane -L 8
bind C-j resize-pane -D 5
bind C-k resize-pane -U 5
bind C-l resize-pane -R 8

# Split using the same keys as Vim
bind v split-window -h  # Vertical split
bind s split-window -v  # Horizontal split
bind _ resize-pane -Z   # Make current pane full-screen
bind = select-layout -E # Make all panes equal size

# prefix + [ (or å) starts copy mode at cursor position
# prefix + ' starts copy mode at the start of the line above the prompt
bind \' copy-mode \; send -X start-of-line \; send -X cursor-up \; send -X cursor-up

# Use v to start selecting and y to copy in copy-mode, like in Vim
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# Press p in copy-mode to copy and paste the current selection
bind -T copy-mode-vi p send -X copy-selection-and-cancel \; run -b 'tmux paste-buffer'

# Esc in copy-mode deselects if something is selected, otherwise exits copy-mode
bind -T copy-mode-vi Escape if -F '#{selection_present}' 'send-keys -X clear-selection' 'send-keys -X cancel'

# Make tmux a bit more usable with Swedish keymap
bind å copy-mode     # Like [ = Start copy-mode at cursor position
bind ä paste-buffer  # Like ] = Paste
bind Å swap-pane -U  # Like { = Move current pane up/left
bind Ä swap-pane -D  # Like } = Move current pane down/right
bind ö last-pane     # Like ; = Go back to the last pane

# Disable mouse support by default and toggle it on/off with prefix+m
set -g mouse off
bind m if -F '#{mouse}' \
  'set -g mouse off ; display-message "Mouse OFF"' \
  'set -g mouse on ; display-message "Mouse ON"'

# Select session with prefix+Shift-s because we rebound prefix+s above.
bind S choose-tree -Zs


# Used with astrocommunity.terminal-integration.vim-tmux-navigator in AstroNvim
# for enabling cross-tmux/vim Ctrl-Shift-h/j/k/l pane navigation.
vim_pattern='(\S+/)?g?\.?(view|l?n?vim?x?|fzf)(diff)?(-wrapped)?'
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +${vim_pattern}$'"
bind-key -n 'C-H' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-J' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-K' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-L' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
bind-key -n 'C-\' if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'
bind-key -T copy-mode-vi 'C-H' select-pane -L
bind-key -T copy-mode-vi 'C-J' select-pane -D
bind-key -T copy-mode-vi 'C-K' select-pane -U
bind-key -T copy-mode-vi 'C-L' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
